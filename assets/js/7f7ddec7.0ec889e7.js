"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([["4915"],{31510:function(e,n,r){r.r(n),r.d(n,{frontMatter:()=>d,default:()=>u,contentTitle:()=>o,assets:()=>a,toc:()=>c,metadata:()=>s});var s=JSON.parse('{"id":"\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177/Redis \u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0","title":"Redis \u7684\u5206\u5E03\u5F0F\u9501\u6A21\u62DF","description":"","source":"@site/docs/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177/Redis \u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0.mdx","sourceDirName":"\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177","slug":"/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177/Redis \u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0","permalink":"/docs/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177/Redis \u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0","draft":false,"unlisted":false,"editUrl":"https://github.com/docs/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u73A9\u5177/Redis \u7684\u5206\u5E03\u5F0F\u9501\u5B9E\u73B0.mdx","tags":[],"version":"current","frontMatter":{},"sidebar":"\u540E\u7AEF","previous":{"title":"Redis","permalink":"/docs/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/"},"next":{"title":"\u8FD0\u884C\u65F6\u62A5\u9519\uFF1A","permalink":"/docs/\u540E\u7AEF/\u6570\u636E\u5E93/Redis/\u95EE\u9898\u4E0E\u65B9\u6CD5"}}'),t=r(96773),i=r(16070);let d={},o="Redis \u7684\u5206\u5E03\u5F0F\u9501\u6A21\u62DF",a={},c=[];function l(e){let n={code:"code",h1:"h1",header:"header",pre:"pre",...(0,i.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.header,{children:(0,t.jsx)(n.h1,{id:"redis-\u7684\u5206\u5E03\u5F0F\u9501\u6A21\u62DF",children:"Redis \u7684\u5206\u5E03\u5F0F\u9501\u6A21\u62DF"})}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-js",children:'// \u2705 \u81EA\u5B9A\u4E49 redis \u5168\u5C40\u9501\u673A\u5236\u3002\nimport crypto from "crypto";\n\n// \u751F\u6210\u9501\nexport async function acquireLock(key: any, ttl = 15) {\n  const redisServer = global.redis;\n  const token = crypto.randomUUID(); // \u751F\u6210\u552F\u4E00 token\n\n  const result = await redisServer.set(key, token, {\n    NX: true,\n    EX: ttl,\n  });\n\n  // \u8BBE\u7F6E\u6210\u529F\uFF0C\u8FD4\u56DE\u503C`OK`\n  if (result === "OK") {\n    return token;\n  } else {\n    return null; // \u83B7\u53D6\u5931\u8D25\n  }\n}\n\n// \u83B7\u53D6\u9501\nexport async function getLock(key: any) {\n  const redisServer = global.redis;\n  const value = await redisServer.get(key);\n\n  return value;\n}\n\n// \u91CA\u653E\u9501\nexport async function releaseLock(key: any) {\n  const redisServer = global.redis;\n\n  // \u5220\u9664\u6210\u529F\uFF0C\u8FD4\u56DE\u503C`1`\n  const result = await redisServer.del(key);\n\n  return result === 1;\n}\n'})})]})}function u(e={}){let{wrapper:n}={...(0,i.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(l,{...e})}):l(e)}}}]);